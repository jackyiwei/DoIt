<!DOCTYPE html>


<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <title>Task Creation</title>

    <!-- Load style sheets -->
    <link rel="stylesheet" type="text/css" href="styles.css" />

    <!-- Load any supplemental Javascript libraries here -->
    <script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>


    <script type="text/javascript" src="jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js"></script>


    <link rel="stylesheet" type ="text/css" href="jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.min.css">


    <!-- Bootstrap 
    <link rel="stylesheet" type="text/css" href="bootstrap-3.1.1-dist/css/bootstrap.min.css" /> -->

	<script type="text/javascript" src="data.js"></script>

<script>
  $(function() {
    $( "#datepicker" ).datepicker({
		minDate: 0
	});
  });
	$.extend({
		getUrlVars : function() {
			var vars = [], hash;
			var hashes = window.location.href.slice(
					window.location.href.indexOf('?') + 1).split('&');
			for ( var i = 0; i < hashes.length; i++) {
				hash = hashes[i].split('=');
				vars.push(hash[0]);
				vars[hash[0]] = hash[1];
			}
			return vars;
		},
		getUrlVar : function(name) {
			return $.getUrlVars()[name];
		}
	});
	
	function bindDeleteReminders() {	
		$('.deleteReminder').click(function(e) {
			var table = document.getElementById("table");
		
			var element = e.currentTarget.parentElement.parentElement;
			element.parentNode.removeChild(element);
			
			var rows = table.rows;
			for (var i = 5; i < rows.length - 1; i++) {
				var rowObj = $('#' + rows[i].id);
				rowObj.find('.reminder').attr('id', 'reminder' + (i - 5));
				rows[i].id = 'reminderRow' + (i - 5);
			}				
		});	
	}
  
	$(document).ready(function() {
		var doneLoading = function() { 				
			if ($.getUrlVar('id')) {
				task = d.getTask($.getUrlVar('id'));
				if (task) {
					//edit task
					$('#title').html('Edit Task');
					
					document.getElementById('taskTitle').value = task.name;
					
					$('#datepicker').datepicker("setDate", new Date(task.year, task.month, task.day));
					
					document.getElementById('assigned').value = task.assigned;
					document.getElementById('reward').value = task.reward;
					
					
					if (task.reminders && task.reminders.length > 0) {
						document.getElementById('reminder0').value = task.reminders[0];
						
						var table = document.getElementById("table");
						for (var i = 1; i < task.reminders.length; i++) {							
							var row = table.insertRow(5 + i);
							
							row.id = 'reminderRow' + i;
							
							var cell1 = row.insertCell(0);
							var cell2 = row.insertCell(1);
							var cell3 = row.insertCell(2);
							
							cell2.innerHTML = '<input type="text" name="reminder' + i + '" id="reminder' + i + '" value="' + task.reminders[i] + '" class="reminder">';
							cell3.innerHTML = '<img src="delete.png" alt="Delete Task" height="16px" width="16px" class="deleteReminder">';
						}
					}
					
					document.getElementById('details').value = task.details;
				}
			}
			
			bindDeleteReminders();
			
			$("#btnSave").click(function() {
				document.location = 'main page v1 4-10-14.html';
			});
			
			$("#btnBack").click(function() {
				document.location = 'main page v1 4-10-14.html';
			});		
			
			$("#btnNewReminder").click(function() {
				var table = document.getElementById("table");
				var i = table.rows.length - 6;
				
				var row = table.insertRow(5 + i);
				
				row.id = 'reminderRow' + i;
				
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				
				cell2.innerHTML = '<input type="text" name="reminder' + i + '" id="reminder' + i + '" class="reminder">';
				cell3.innerHTML = '<img src="delete.png" alt="Delete Task" height="16px" width="16px" class="deleteReminder">';	

				bindDeleteReminders();				
			});
		}
		
		d = new Data(doneLoading);			
	});
</script>


</head>

<body>
    <h1 id='title'>Create Task</h1>
    <button type="button" class="back_button" id='btnBack'>
      Back
    </button>

    <button type="button" class="save_button" id='btnSave'>
      Save
    </button> 

	<hr></hr>
	
    <table id='table'>
        <tr>
            <td>Task: </td>
            <td><input type="text" name="taskTitle" id="taskTitle"></td>
        </tr>

        <tr>
            <td>Deadline: </td>
            <td><input type="text" id="datepicker"></td>
        </tr>
		
		<tr>
            <td>Recurring: </td>
            <td class="td" >TODO</td>
        </tr>

        <tr>
            <td>Assigned To: </td>
            <td><input type="text" name="assigned" id="assigned"></td>
        </tr>

        <tr>
            <td>Reward ($):</td>
            <td><input type="text" name="reward" id="reward"></td>
        </tr>
        <tr id="reminderRow0">
            <td>Reminders:</td>
            <td><input type="text" name="reminder0" id="reminder0" class="reminder"></td>
        </tr>
		<tr>
			<td></td>
			<td><button type="button" class=button" id='btnNewReminder'>Add New Reminder</button></td>
		</tr>
    </table>


    Details: <br>
    <textarea rows="4" cols="50" placeholder="Enter details here..." id="details"></textarea>





</body>

</html>
