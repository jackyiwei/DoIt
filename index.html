<!DOCTYPE html>


<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <title>Task Creation</title>

	<!-- Load Font Awesome -->	
	<link rel="stylesheet" href="font-awesome-4.0.3/css/font-awesome.min.css">
	
    <!-- Load style sheets -->	
    <link rel="stylesheet" type="text/css" href="styles.css" />
	<link type="text/css" href="main_page_buttons.css" rel="stylesheet" />

    <!-- Load any supplemental Javascript libraries here -->
    <script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>


    <script type="text/javascript" src="jquery-ui-1.10.4 3.custom/js/jquery-ui-1.10.4.custom.min.js"></script>

	<script type="text/javascript" src="external_js/jquery.json-2.4.js"></script>

    <link rel="stylesheet" type ="text/css" href="jquery-ui-1.10.4 3.custom/css/redmond/jquery-ui-1.10.4.custom.min.css">


    <!-- Bootstrap
    <link rel="stylesheet" type="text/css" href="bootstrap-3.1.1-dist/css/bootstrap.min.css" /> -->

	<script type="text/javascript" src="data.js"></script>

<script>
  $(function() {
    $( "#datepicker" ).datepicker({
		minDate: 0
	});
  });
	$.extend({
		getUrlVars : function() {
			var vars = [], hash;
			var hashes = window.location.href.slice(
					window.location.href.indexOf('?') + 1).split('&');
			for ( var i = 0; i < hashes.length; i++) {
				hash = hashes[i].split('=');
				vars.push(hash[0]);
				vars[hash[0]] = hash[1];
			}
			return vars;
		},
		getUrlVar : function(name) {
			return $.getUrlVars()[name];
		}
	});

	function bindDeleteReminders() {
		//Happens when a user deletes a reminder
		$('.fa.fa-times').click(deleteButtonPressed);
		$('.fa.fa-times').tooltip();
	}
	
	function deleteButtonPressed(e) {
		$('.fa.fa-times').tooltip("close");
	
		var table = document.getElementById("table");					
		if (table.rows.length ==  7) {
			//Deleted only reminder
			document.getElementById('reminder0').value = '';
		}
		else {
			//There's at least two reminder rows (including the top-most one)
			var element = e.currentTarget.parentElement.parentElement;
			
			element.parentNode.removeChild(element);

			//changes id of rows and their input boxes to be what we expect them to be post delete
			var rows = table.rows;
			for (var i = 5; i < rows.length - 1; i++) {
				var rowObj = $('#' + rows[i].id);
				rowObj.find('.reminder').attr('id', 'reminder' + (i - 5));
				rows[i].id = 'reminderRow' + (i - 5);

				//Makes sure the first reminder row has text
				if (i == 5) {
					rowObj.find('.firstCol').html('Reminders:');
				}
			}
		}
	}	

    function checkAddress(checkbox) {
        if (checkbox.checked) {
            document.getElementById('checkText').innerHTML = 'daily';
        } else {
            document.getElementById('checkText').innerHTML = '';
        }
    }

	$(document).ready(function() {
		var doneLoading = function() {
			if ($.getUrlVar('id')) {
				task = d.getTask($.getUrlVar('id'));
				if (task) {
					//edit task
					$('#title').html('Edit Task');

					document.getElementById('taskTitle').value = task.name;

					$('#datepicker').datepicker("setDate", new Date(task.year, task.month, task.day));

					document.getElementById('assigned').value = task.assigned;
					document.getElementById('reward').value = task.reward;

					//Makes page show current reminders set for task
					if (task.reminders && task.reminders.length > 0) {
						document.getElementById('reminder0').value = task.reminders[0];

						var table = document.getElementById("table");
						for (var i = 1; i < task.reminders.length; i++) {
							var row = table.insertRow(5 + i);

							row.id = 'reminderRow' + i;

							var cell1 = row.insertCell(0);
							var cell2 = row.insertCell(1);
							var cell3 = row.insertCell(2);

							cell1.className = "firstCol";
							cell2.className = "reminder_td";
							cell2.innerHTML = '<input type="text" name="reminder' + i + '" id="reminder' + i + '" value="' + task.reminders[i] + '" class="reminder"><div class="daysBefore">days before</div>';
							cell3.innerHTML = '<i class="fa fa-times" title="Delete reminder" id="btnDelete' + i + '"></i>';
						}
					}

					document.getElementById('details').value = task.details;
				}
			}

			$("#assigned").autocomplete({
				minLength: 0,
				delay: 0,
				source: d.getKids()
			}).on("focus", function () {				
				$(this).autocomplete("search", document.getElementById("assigned").value);
			});
			
			//Bind the click operation for delete reminder icons
			bindDeleteReminders();

			callback = function() {
				if ($.getUrlVar('startDate')) {
					document.location = 'main%20page%20v1%204-10-14.html?startDate=' + $.getUrlVar('startDate');
				}
				else
				{
					document.location = 'main%20page%20v1%204-10-14.html';
				}
			};
			
			//Creates/Saves task. Should display dialog box warning user about the editing of repeating tasks.
			$("#btnSave").click(function() {
				if ($.getUrlVar('id') && d.getTask($.getUrlVar('id'))) {
					task = d.getTask($.getUrlVar('id'));
					d.updateTask(task.id, "Edited Task", new Date(task.year, task.month, task.day), task.repeat, task.assigned, task.reward, task.reminders, task.details, callback);
				}
				else {
					d.createTask("New Task", new Date(), null, null, null, [0,1,2], "no details for this task", callback);					
				}
			});

			//Back button clicked. Should ideally display dialog box warning user that he's discarding his changes (if he made any)
			$("#btnBack").click(callback);

			//Add new reminder button clicked
			$("#btnNewReminder").click(function() {
				var table = document.getElementById("table");
				var i = table.rows.length - 6;

				var row = table.insertRow(5 + i);

				row.id = 'reminderRow' + i;

				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);

				cell1.className = "firstCol";
				cell2.className = "reminder_td";
				cell2.innerHTML = '<input type="text" name="reminder' + i + '" id="reminder' + i + '" class="reminder"><div class="daysBefore">days before</div>';
				cell3.innerHTML = '<i class="fa fa-times" title="Delete reminder" id="btnDelete' + i + '"></i>';
				

				//Bind the click operation for delete reminder icons				
				$('#btnDelete' + i).click(deleteButtonPressed);
				$('#btnDelete' + i).tooltip();
			});
		}

		d = new Data(doneLoading);
	});
	
	
	$(function() {
		var name = $( "#name" ),
		  email = $( "#email" ),
		  password = $( "#password" ),
		  allFields = $( [] ).add( name ).add( email ).add( password ),
		  tips = $( ".validateTips" );
	 
		function updateTips( t ) {
		  tips
			.text( t )
			.addClass( "ui-state-highlight" );
		  setTimeout(function() {
			tips.removeClass( "ui-state-highlight", 1500 );
		  }, 500 );
		}
	 
		function checkLength( o, n, min, max ) {
		  if ( o.val().length > max || o.val().length < min ) {
			o.addClass( "ui-state-error" );
			updateTips( "Length of " + n + " must be between " +
			  min + " and " + max + "." );
			return false;
		  } else {
			return true;
		  }
		}
	 
		function checkRegexp( o, regexp, n ) {
		  if ( !( regexp.test( o.val() ) ) ) {
			o.addClass( "ui-state-error" );
			updateTips( n );
			return false;
		  } else {
			return true;
		  }
		}
		
		$( "#dialog-form" ).dialog({
		  autoOpen: false,
		  height: 700,
		  width: 600,
		  modal: true,
		  buttons: {
			"Done": function() {
			  var bValid = true;
			  allFields.removeClass( "ui-state-error" );
	 
			  bValid = bValid && checkLength( name, "username", 3, 16 );
			  bValid = bValid && checkLength( email, "email", 6, 80 );
			  bValid = bValid && checkLength( password, "password", 5, 16 );
	 
			  bValid = bValid && checkRegexp( name, /^[a-z]([0-9a-z_])+$/i, "Username may consist of a-z, 0-9, underscores, begin with a letter." );
			  // From jquery.validate.js (by joern), contributed by Scott Gonzalez: http://projects.scottsplayground.com/email_address_validation/
			  bValid = bValid && checkRegexp( email, /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i, "eg. ui@jquery.com" );
			  bValid = bValid && checkRegexp( password, /^([0-9a-zA-Z])+$/, "Password field only allow : a-z 0-9" );
	 
			  if (true ){// bValid ) {
				$( "#users tbody" ).append( "<tr>" +
				  "<td>" + name.val() + "</td>" +
				  "<td>" + email.val() + "</td>" +
				  "<td>" + password.val() + "</td>" +
				"</tr>" );
				$( this ).dialog( "close" );
			  }
			},
			Cancel: function() {
			  $( this ).dialog( "close" );
			}
		  },
		  close: function() {
			allFields.val( "" ).removeClass( "ui-state-error" );
		  }
		});
 
		$("#checkAddress")
			.click(function() {
				$( "#dialog-form" ).dialog( "open" );
		});
	});
	
</script>


</head>

<body>
    <h1 id='title'>Create Task</h1>
    <button type="button" class="back_button" id='btnBack'>Back</button>

    <button type="button" class="save_button" id='btnSave'>Save</button>

	<hr></hr>

    <table id='table'>
        <tr>
            <td>Task: </td>
            <td><input type="text" name="taskTitle" id="taskTitle"></td>
        </tr>

        <tr>
            <td>Deadline: </td>
            <td><input type="text" id="datepicker"></td>
        </tr>

		<tr>
            <td>Repeat: </td>
            <td class="repeat_td" >
				<input type="checkbox" id="checkAddress" onclick="checkAddress(this)" checked="checked" autocomplete="off" />
				<p size=3 id= "checkText" style="display:inline;font-size:16px">daily</p>
			</td>
        </tr>

        <tr>
            <td>Assigned To: </td>
            <td><input type="text" name="assigned" id="assigned"></td>
        </tr>

        <tr>
            <td>Reward ($):</td>
            <td><input type="text" name="reward" id="reward"></td>
        </tr>
        <tr id="reminderRow0">
            <td class="firstCol">Reminders:</td>
            <td class="reminder_td"><input type="text" name="reminder0" id="reminder0" class="reminder"><div class="daysBefore">days before</div></td>
			<td><i class="fa fa-times" title="Delete reminder" id="btnDelete0"></i></td>
        </tr>
		<tr>
			<td></td>
			<td><button type="button" class=button" id='btnNewReminder'>Add New Reminder</button></td>
		</tr>
    </table>

    Details: <br>
    <textarea rows="4" cols="50" placeholder="Enter details here..." id="details"></textarea>
	
	<div id="dialog-form" title="Repeat Details">
	  <p class="validateTips">All form fields are required.</p>
	 
	  <form>
		<table id="form_table">
			<tr>
				<td>
					<label for="repeat_day_week">Repeat: </label>
				</td>
				<td>
					<select id="dropdown_type">
						<option value="daily">Daily</option>
						<option value="weekly">Weekly</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>
					<label for="Number_of">Repeat every: </label>
				</td>
				<td>
					<input type="text" name="days_weeks" id="days_weeks" value="" class="text ui-widget-content ui-corner-all"> weeks
				</td>
			</tr>
			<tr>
				<td>
					<label for="days_of_week">Repeat on: </label>
				</td>
				<td>
					<input type="checkbox" name="Sunday" id="Sunday"> S
					<input type="checkbox" name="Sunday" id="Sunday"> M
					<input type="checkbox" name="Sunday" id="Sunday"> T
					<input type="checkbox" name="Sunday" id="Sunday"> W
					<input type="checkbox" name="Sunday" id="Sunday"> T
					<input type="checkbox" name="Sunday" id="Sunday"> F
					<input type="checkbox" name="Sunday" id="Sunday"> S
				</td>
			</tr>
			<tr>
				<td>
					<label for="end_date">Ends: </label>
				</td>
				<td>
					<input type="radio" name="end_date" value="never">Never</input>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<input type="radio" name="end_date" value="date">Ends on: </input>
					<input type="text" name="end_date" id="end_date" value="" class="text ui-widget-content ui-corner-all">
				</td>
			</tr>
		</table>
	  </form>
	</div>

</body>

</html>
